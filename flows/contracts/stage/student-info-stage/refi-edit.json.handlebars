{{#with application.primary}}
{
    "key": "student-personal-info-edit",
    "type": "form",
    "label": "Edit Student Info",
    "status": "notStarted",
    "showProgress": true,
    "steps": {{{json (contract 'steps')}}},
    "validation": {
        "type": "object",
        "properties": {
            "editPersonalInfo": {
                "type": "object",
                "properties": {
                    "name": {{{json (schema 'questions/primary/name')}}},
                    "dateOfBirth": {{{json (schema 'questions/primary/dateOfBirth')}}},
                    "phone": {{{json (schema 'questions/primary/phone')}}},
                    "email": {{{json (schema 'questions/primary/email')}}},
                    "currentAddress": {{{json (schema 'questions/primary/address')}}},
                    {{#if (findPreviousAddress details.location)}}
                        "previousAddress": {{{json (schema 'questions/primary/address')}}},
                    {{/if}}
                    "citizenship": {{{json (schema 'questions/primary/citizenship')}}},
                    "ssn": {{{json (schema 'questions/primary/ssn')}}}
                }
            },
            "editEducationInfo": {
                "type": "object",
                "properties": {
                    "school": {{{json (schema 'questions/primary/school')}}},
                    "degree": {{{json (schema 'questions/primary/degree')}}},
                    "graduationDate": {{{json (schema 'questions/primary/graduationDate')}}}
                }
            },
            "editLoanlDetails": {
                "type": "object",
                "properties": {
                    "loanAmount": {{{json (schema 'questions/primary/loan')}}}
                }
            },
            "editEmploymentInfo": {
                "type": "object",
                "properties": {
                    "employmentType": {
                        "enum": ["employed", "self_employed", "future", "retired", "unemployed"],
                        "errorMessage": {
                            "enum": "Please select an employment status"
                        }
                    },
                    "employerName": {{{json (schema 'questions/primary/employment/employer-name')}}},
                    "jobTitle": {{{ json (schema 'questions/primary/employment/job-title')}}},
                    "startDate": {{{ json (schema 'questions/primary/employment/start-date')}}},
                    "sourcesOfIncome": {
                        "type": "string",
                        "enum": ["social_security_or_pension", "investment"],
                        "errorMessage": {
                            "enum": "Please select a source of income"
                        }                    
                    },
                    "addAddtionalIncome": {
                        "type": "string",
                        "enum": ["true", "false"],
                        "errorMessage": {
                            "enum": "Please select Yes or No"
                        }    
                    },
                    "hasConsistentIncome": {
                        "type": "string",
                        "enum": ["true", "false"],
                        "errorMessage": {
                            "enum": "Please select Yes or No"
                        }
                    },
                    "annualIncome": {{{json (schema 'questions/primary/income/amount/annual-income')}}},
                    "annualIncomeFuture": {{{json (schema 'questions/primary/income/amount/annual-income')}}},
                    "claimedAssets": {{{json (schema 'questions/primary/income/amount/claimed-assets')}}},
                    "additionalAmount": {{{json (schema 'questions/primary/income/amount/additional-income')}}}
                },
                "allOf": [
                    { "$ref": "#/properties/editEmploymentInfo/definitions/retired-requires-props" },
                    { "$ref": "#/properties/editEmploymentInfo/definitions/unemployed-requires-props" },
                    { "$ref": "#/properties/editEmploymentInfo/definitions/employed-requires-props" },
                    { "$ref": "#/properties/editEmploymentInfo/definitions/self-employed-requires-props" },
                    { "$ref": "#/properties/editEmploymentInfo/definitions/future-employed-requires-props" }
                ],
                "required": ["employmentType"],
                "definitions": {
                    "is-employed": {
                        "properties": {
                            "employmentType": { "enum": ["employed"] }
                        },
                        "required": ["employmentType"]
                    },
                    "is-self-employed": {
                        "properties": {
                            "employmentType": { "enum": ["self_employed"] }
                        },
                        "required": ["employmentType"]
                    },
                    "is-future": {
                        "properties": {
                            "employmentType": { "enum": ["future"] }
                        },
                        "required": ["employmentType"]
                    },
                    "is-retired": {
                        "properties": {
                            "employmentType": { "enum": ["retired"] }
                        },
                        "required": ["employmentType"]
                    },
                    "is-unemployed": {
                        "properties": {
                            "employmentType": { "enum": ["unemployed"] }
                        },
                        "required": ["employmentType"]
                    },
                    "retired-requires-props": {
                        "anyOf": [
                            { "not": { "$ref": "#/properties/editEmploymentInfo/definitions/is-retired"  } },
                            { "required": ["sourcesOfIncome", "addAddtionalIncome"]}
                        ]
                    },
                    "unemployed-requires-props": {
                        "anyOf": [
                            { "not": { "$ref": "#/properties/editEmploymentInfo/definitions/is-unemployed"  } },
                            { "required": ["hasConsistentIncome"]}
                        ]
                    },
                    "employed-requires-props": {
                        "anyOf": [
                            { "not": { "$ref": "#/properties/editEmploymentInfo/definitions/is-employed"  } },
                            { "required": ["employerName", "jobTitle", "annualIncome", "claimedAssets", "additionalAmount"]}
                        ] 
                    },
                    "self-employed-requires-props": {
                        "anyOf": [
                            { "not": { "$ref": "#/properties/editEmploymentInfo/definitions/is-self-employed"  } },
                            { "required": ["jobTitle", "startDate", "annualIncome", "claimedAssets", "additionalAmount"]}
                        ] 
                    },
                    "future-employed-requires-props": {
                        "anyOf": [
                            { "not": { "$ref": "#/properties/editEmploymentInfo/definitions/is-future"  } },
                            { "required": ["employerName", "jobTitle", "startDate", "annualIncome", "claimedAssets", "additionalAmount"]}
                        ] 
                    }

                }
            }
        }
    }
}
{{/with}}