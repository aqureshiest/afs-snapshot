{{#if request.params.id}}
  {{#noop}}{{ contract 'analytics' }}{{/noop}}
  {{#with (contract "generate-assets-report") as |plaidAssetsReportResponse|}}
    {{#if (and (gte plaidAssetsReportResponse.response.statusCode 200) (lt plaidAssetsReportResponse.response.statusCode 400))}}  
        {
          "event": "addDetails",
          "payload": {
            "id": "{{../request.params.id}}",
            "details":
              {{#with ../request.body.values}} 
                  {{#if financialAccounts}}
                  {"financialAccounts": {{#list}}
                    {{#each financialAccounts}}
                      {"name": "{{this.name}}" {{#if (not (eq @index undefined))}},"index": {{{ number @index }}}{{/if}} {{#if this.balance}} , "balance": {{formatDollarsToCents this.balance}} {{/if}}, "account_last4": "{{this.account_last4}}", "type": "{{this.type}}", "selected": {{{boolean this.selected}}} {{#if (eq this.plaid true)}} ,"plaidAssetsReportID": "{{plaidAssetsReportResponse.results.asset_report_token}}" {{/if}} }
                    {{/each}}
                  {{/list}} }
                  {{else}}
                    {}
                  {{/if}}
              {{/with}}
          },
          "fields": "application { id }"
        }
    {{/if}}
    {{else}}
      {}
  {{/with}}
{{else}}
  null
{{/if}}
