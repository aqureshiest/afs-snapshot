{{#if request.params.id}}
  {
    "event": "addDetails",
    "payload": {
      "id": "{{request.params.id}}",
      {{#with request.body.values}}
      "details":
        {{#obj}} {{! make sure to flatten each element into a single line}}
          {{#if loanAmount}}
            {"amount": {"requested": {{{formatDollarsToCents loanAmount}}} } }
          {{/if}}
          {{#if dateOfBirth}}
            {"dateOfBirth": "{{{dateObjToString dateOfBirth}}}"}
          {{/if}}
          {{#if name}}
            {"name": {{{json name}}} }
          {{/if}}
          {{#if email}}
            {"email": "{{email}}"}
          {{/if}}
          {{#if phone}}
            {"phone": [{"index": 0, "number": "{{phone}}", "type": "mobile"}]}
          {{/if}}
          {{#if (or currentAddress previousAddress) }}
            {"location": {{#list}}
              {{#if currentAddress}}
                {"index": 0, "street1": "{{currentAddress.street}}", {{#if currentAddress.apt}} "street2": "{{currentAddress.apt}}", {{/if}} "city": "{{currentAddress.city}}", "state": "{{currentAddress.state}}", "zip": "{{currentAddress.zip}}" , "type": "primary" {{#if citizenship}} , "citizenship": "{{citizenship}}" {{/if}} }
              {{/if}}
              {{#if previousAddress }}
                {"index": 1, "street1": "{{previousAddress.street}}", {{#if previousAddress.apt}} "street2": "{{previousAddress.apt}}", {{/if}} "city": "{{previousAddress.city}}", "state": "{{previousAddress.state}}", "zip": "{{previousAddress.zip}}" , "type": "previous" {{#if citizenship}} , "citizenship": "{{citizenship}}" {{/if}} }
              {{/if}}
            {{/list}} }
          {{/if}}
          {{#if (or school degree graduationDate)}}
            {"education": [{"index": 0 {{#if school }}, "opeid": "{{school.opeid8}}" {{/if}} {{#if degree}}, "degree": "{{degree}}" {{/if}} {{#if graduationDate}}, "graduationDate": "{{dateObjToString graduationDate}}" {{/if}} }]}
          {{/if}}
          {{#if employmentType}}
              {"income": {{#list}}
                {"index": 0, "type": "{{employmentType}}" {{#if jobTitle}}, "title": "{{jobTitle}}" {{/if}} {{#if (or annualIncome annualIncomeFuture)}}, "amount": {{#if annualIncome}} {{{formatDollarsToCents annualIncome}}} {{else if annualIncomeFuture}} {{{formatDollarsToCents annualIncomeFuture}}} {{/if}} {{/if}} {{#if employerName}}, "employer": "{{employerName}}" {{/if}} {{#if (and startDate (hasValues startDate) )}}, "start": "{{{dateObjToString startDate}}}" {{/if}} }
                {{#if sourcesOfIncome}}
                  {"index": 1, "type": "{{sourcesOfIncome}}" }
                {{/if}}
                {{#if additionalAmount}}
                  {{#if additionalAmount.[0]}}
                    {"index": 2, "type": "{{additionalAmount.0.type}}", "amount": {{{formatDollarsToCents additionalAmount.0.value}}} }
                  {{/if}}
                  {{#if additionalAmount.[1]}}
                      {"index": 3, "type": "{{additionalAmount.1.type}}", "amount": {{{formatDollarsToCents additionalAmount.1.value}}} }
                  {{/if}}
                  {{#if additionalAmount.[2]}}
                      {"index": 4, "type": "{{additionalAmount.2.type}}", "amount": {{{formatDollarsToCents additionalAmount.2.value}}} }
                  {{/if}}
                  {{#if additionalAmount.[3]}}
                      {"index": 5, "type": "{{additionalAmount.3.type}}", "amount": {{{formatDollarsToCents additionalAmount.3.value}}} }
                  {{/if}}
                  {{#if additionalAmount.[4]}}
                      {"index": 6, "type": "{{additionalAmount.4.type}}", "amount": {{{formatDollarsToCents additionalAmount.4.value}}} }
                  {{/if}}
                {{/if}}
              {{/list}}
              }
          {{/if}}
          {{#if claimedAssets}}
            {"asset": [{"index": 0, "type": "claimed_total_assets", "amount": {{{formatDollarsToCents claimedAssets}}} }]}
          {{/if}}
          {{#if financialAccounts}}
            {"financialAccounts": {{{json financialAccounts}}} }
          {{/if}}
        {{/obj}}
    },
    {{/with}}
    "fields": "application { id }"
  }
{{else}}
  null
{{/if}}