{{#if (and request.params.id (or (testIsArray request.body.values.additionalAmountRetired) (testIsArray request.body.values.additionalAmount)))}}
  {
    "event": "removeDetails",
    "payload": {
      "id": "{{request.params.id}}",
      "details": { {{! make sure to flatten each element into a single line}}
        {{#with request.body.values}}
          {{#if (testIsArray additionalAmountRetired) }}
            "income": [
                {"index": 0, "keys": ["type", "amount", "employer", "name", "start", "end", "title"] },
                {"index": 1, "keys": ["type", "amount", "employer", "name", "start", "end", "title"] },
                {"index": 2, "keys": ["type", "amount", "employer", "name", "start", "end", "title"] },
                {"index": 3, "keys": ["type", "amount", "employer", "name", "start", "end", "title"] },
                {"index": 4, "keys": ["type", "amount", "employer", "name", "start", "end", "title"] },
                {"index": 5, "keys": ["type", "amount", "employer", "name", "start", "end", "title"] }
              ]
          {{else if (testIsArray additionalAmount) }}
            "income": [
                {"index": 1, "keys": ["type", "amount", "employer", "name", "start", "end", "title"] },
                {"index": 2, "keys": ["type", "amount", "employer", "name", "start", "end", "title"] },
                {"index": 3, "keys": ["type", "amount", "employer", "name", "start", "end", "title"] },
                {"index": 4, "keys": ["type", "amount", "employer", "name", "start", "end", "title"] },
                {"index": 5, "keys": ["type", "amount", "employer", "name", "start", "end", "title"] }
              ]
          {{/if}}
        {{/with}}
      }
    },
    "fields": "application { id }"
  }
{{else}}
  {}
{{/if}}