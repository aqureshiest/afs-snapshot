{{#if request.params.id}}
{{#noop}}{{ contract 'analytics' }}{{/noop}}
  {
    "event": "addDetails",
    "payload": {
      "id": "{{request.params.id}}",
      "details": {{#obj}} {{! make sure to flatten each element into a single line}}
        {{#with request.body.values}}
          {{#if loanAmount}}
            {"amount": {"requested": {{{formatDollarsToCents loanAmount}}} } }
          {{/if}}
          {{#if dateOfBirth}} 
            {"dateOfBirth": "{{{dateObjToString dateOfBirth}}}"}
          {{/if}}
          {{#if name}}
            {"name": {{{json name}}} }
          {{/if}}
          {{#if email}}
            {"email": "{{email}}"}
          {{/if}}
          {{#if phone}}
            {"phone": [{"index": 0, "number": "{{phone}}", "type": "mobile"}]}
          {{/if}}
          {{#if currentAddress }}
            {"location": [{"index": 0, "street1": "{{currentAddress.street}}", {{#if (ne currentAddress.apt "") }} "street2": "{{currentAddress.apt}}", {{/if}} "city": "{{currentAddress.city}}", "state": "{{currentAddress.state}}", "zip": "{{currentAddress.zip}}" , "type": "primary" {{#if citizenship}} , "citizenship": "{{citizenship}}" {{/if}} }]}
          {{/if}}
          {{#if previousAddress }} 
            {"location": [{"index": 1, "street1": "{{previousAddress.street}}", {{#if (ne previousAddress.apt "") }} "street2": "{{previousAddress.apt}}", {{/if}} "city": "{{previousAddress.city}}", "state": "{{previousAddress.state}}", "zip": "{{previousAddress.zip}}" , "type": "previous" {{#if citizenship}} , "citizenship": "{{citizenship}}" {{/if}} }]}
          {{/if}}
          {{#if employmentType }}
            {"income": [{"index": 0, "type": "{{employmentType}}"}]}
          {{/if}}
          {{#if jobTitle}}
            {"income": [{"index": 0, "title": "{{jobTitle}}", "amount": {{{formatDollarsToCents annualIncome}}} {{#if employerName}}, "employer": "{{employerName}}" {{/if}} {{#if startDate}}, "start": "{{{dateObjToString startDate}}}" {{/if}} }]}
          {{/if}}
          {{#if claimedAssets}}
            {"asset": [{"index": 0, "type": "claimed_total_assets", "amount": {{{formatDollarsToCents claimedAssets}}} }]}
          {{/if}}
          {{#if additionalAmount}}
            {{! until the additional amount ui component allows for checked box sources, hard code type to 'rental'}}
            {"income": [{"index": 2, "type": "rental", "amount": {{{formatDollarsToCents additionalAmount}}} }]}
          {{/if}}
          {{#if sourcesOfIncome}}
            {"income": [{"index": 1, "type": "{{sourcesOfIncome}}" }]}
          {{/if}}
          {{#if financialAccounts}}
            {"financialAccounts": {{#list}}
              {{#each financialAccounts}}
                {"index": {{{ number this.index}}}, "balance": {{{formatDollarsToCents balance}}},"name": "{{this.name}}", "account_last4": "{{this.account_last4}}", "type": "{{this.type}}", "selected": {{this.selected}} }
              {{/each}}
            {{/list}} }
          {{/if}}
        {{/with}}
      {{/obj}}
    },
    "fields": "application { id }"
  }
{{else}}
  null
{{/if}}
